# description	: The GNU C Library (Toolchain)

name=host-glibc
version=2.29
release=1
options=(buildflags !emptydirs makeflags !strip !zipman)
source=(http://ftpmirror.gnu.org/gnu/glibc/glibc-$version.tar.xz)
sha256sums=(f3eeb8d57e25ca9fc13c2af3dae97754f9f643bc69229546828e3a240e2af04b)

build() {
	cd glibc-$version

	mkdir build && cd build

	echo "libc_cv_forced_unwind=yes" > config.cache
	echo "libc_cv_c_cleanup=yes" >> config.cache
	echo "libc_cv_ssp=no" >> config.cache
	echo "libc_cv_ssp_strong=no" >> config.cache

	BUILD_CC="$HOSTCC" \
	CC="$XTARGET-gcc" \
	AR="$XTARGET-ar" \
	RANLIB="$XTARGET-ranlib" \
	      ../configure \
	      --prefix=/usr \
	      --libdir=/usr/lib \
	      --libexecdir=/usr/lib \
              --with-headers=$SYSROOT_DIR/usr/include \
              --with-binutils=$TOOLS/bin \
	      --build=$XHOST \
	      --host=$XTARGET \
	      --target=$XTARGET \
              --with-pkgversion="Gemstone Linux $version targeting $BUILD_ARCH" \
              --with-bugurl="https://github.com/project-gemstone/gemstone/issues" \
	      --without-gd \
	      --without-selinux \
	      --enable-add-ons \
	      --enable-bind-now \
	      --enable-kernel=3.2 \
	      --enable-lock-elision \
	      --enable-stack-protector=strong \
	      --enable-stackguard-randomization \
	      --disable-profile \
	      --disable-werror \
	      --enable-shared \
	      --cache-file=config.cache

	make -j1

	make install_root=$SYSROOT_DIR install
	
        touch $PKG/empty
}
