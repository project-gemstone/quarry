# description: The Linux kernel
#
# Copyright (c) 2016-2020 Ataraxia Linux <ataraxialinux@protonmail.ch>
# SPDX-License-Identifier: ISC

name=linux
version=5.7.7
case $version in
	*.*.*) kver=$version;;
	*.*) kver=$version.0;;
esac
release=1
source="https://cdn.kernel.org/pub/linux/kernel/v5.x/$name-$version.tar.xz"

yconfig() {
	while [ $# -ne 0 ]; do
		./scripts/config --enable $1
		shift 1
	done
}

mconfig() {
	while [ $# -ne 0 ]; do
		./scripts/config --module $1
		shift 1
	done
}

nconfig() {
	while [ $# -ne 0 ]; do
		./scripts/config --disable $1
		shift 1
	done
}

varconfig() {
	FUONE="$1"
	FUTWO="$2"

	./scripts/config --set-val "$FUONE" "$FUTWO"
}

strconfig() {
	FUONE="$1"
	FUTWO="$2"

	./scripts/config --set-str "$FUONE" "$FUTWO"
}

generate_config() {
	case $BARCH in
		x86_64|i686)
			SUBKARCH="x86"
			;;
		*)
			SUBKARCH="$XKARCH"
			;;
	esac

	case $BARCH in
		x86_64)
			export DEFCONFIG="x86_64_defconfig"
			;;
		aarch64)
			export DEFCONFIG="defconfig"
			;;
		armv7hnl)
			export DEFCONFIG="vexpress_defconfig"
			;;
		armv6hl)
			export DEFCONFIG="versatile_defconfig"
			;;
		ppc64le)
			export DEFCONFIG="powernv_defconfig"
			;;
		ppc64)
			export DEFCONFIG="g5_defconfig"
			;;
		ppc)
			export DEFCONFIG="pmac32_defconfig"
			;;
		s390x)
			export DEFCONFIG="defconfig"
			;;
		riscv64)
			export DEFCONFIG="defconfig"
			;;
		riscv32)
			export DEFCONFIG="rv32_defconfig"
			;;
		*)
			echo "Architecture is not set or is not supported by Ataraxia Linux"
			exit 1
	esac

	if [ "$USEBOOTSTRAP" = "yes" ]; then
		make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE} $DEFCONFIG
	else
		make ARCH=$XKARCH $DEFCONFIG
	fi

	case $BARCH in
		x86_64)
			yconfig 64BIT PCI SERIAL_8250 SERIAL_8250_CONSOLE RTC_CLASS IA32_EMULATION \
				EFI EFI_STUB EFI_MIXED EFI_VARS FB_EFI EFI_RUNTIME_MAP EFIVAR_FS \
				NUMA AMD_NUMA NODES_SPAN_OTHER_NODES NEED_MULTIPLE_NODES USE_PERCPU_NUMA_NODE_ID ACPI_NUMA \
				MICROCODE MICROCODE_EARLY MICROCODE_INTEL MICROCODE_AMD X86_PM_TIMER KVM_AMD_SEV RCU_NOCB_CPU
			nconfig NUMA_EMU XEN_DEBUG_FS
			mconfig KVM_INTEL KVM_AMD FB_HYPERV VBOXGUEST HYPERV HYPERV_UTILS \
				HYPERV_MOUSE HYPERV_NET HYPERV_BALLOON
			varconfig XEN_BALLOON_MEMORY_HOTPLUG_LIMIT 512
			varconfig NODES_SHIFT 6
			;;
		aarch64)
			yconfig EFI EFI_STUB EFI_MIXED EFI_VARS FB_EFI EFI_RUNTIME_MAP EFIVAR_FS
			;;
		riscv64|riscv32)
			yconfig RISCV_ISA_C RISCV_ISA_A FPU SIFIVE_PLIC
			;;
	esac

	# Laptop drivers
	case $BARCH in
		x86_64)
			yconfig X86_PLATFORM_DEVICES INTEL_TURBO_MAX_3 INTEL_PMC_CORE THINKPAD_ACPI_ALSA_SUPPORT THINKPAD_ACPI_VIDEO THINKPAD_ACPI_HOTKEY_POLL \
				SONYPI_COMPAT DELL_SMBIOS_WMI DELL_SMBIOS_SMM
			mconfig ACER_WMI ACER_WIRELESS ACERHDF ALIENWARE_WMI ASUS_LAPTOP DCDBAS DELL_SMBIOS DELL_LAPTOP DELL_WMI DELL_WMI_DESCRIPTOR DELL_WMI_AIO \
				DELL_WMI_LED DELL_SMO8800 DELL_RBTN DELL_RBU FUJITSU_LAPTOP FUJITSU_TABLET AMILO_RFKILL GPD_POCKET_FAN HP_ACCEL HP_WIRELESS HP_WMI LG_LAPTOP \
				MSI_LAPTOP PANASONIC_LAPTOP COMPAL_LAPTOP SONY_LAPTOP IDEAPAD_LAPTOP THINKPAD_ACPI SENSORS_HDAPS INTEL_MENLOW EEEPC_LAPTOP ASUS_WMI ASUS_NB_WMI \
				EEEPC_WMI ASUS_WIRELESS ACPI_WMI WMI_BMOF INTEL_WMI_THUNDERBOLT XIAOMI_WMI MSI_WMI PEAQ_WMI TOPSTAR_LAPTOP ACPI_TOSHIBA TOSHIBA_BT_RFKILL TOSHIBA_HAPS \
				TOSHIBA_WMI ACPI_CMPC INTEL_CHT_INT33FE INTEL_INT0002_VGPIO INTEL_HID_EVENT INTEL_VBTN INTEL_IPS IBM_RTL SAMSUNG_LAPTOP MXM_WMI INTEL_OAKTRAIL SAMSUNG_Q10 \
				APPLE_GMUX INTEL_RST INTEL_SMARTCONNECT INTEL_PMC_IPC INTEL_BXTWC_PMIC_TMU SURFACE_PRO3_BUTTON SURFACE_3_BUTTON INTEL_PUNIT_IPC MLX_PLATFORM INTEL_CHTDC_TI_PWRBTN \
				I2C_MULTI_INSTANTIATE INTEL_ATOMISP2_PM HUAWEI_WMI PCENGINES_APU2
			nconfig THINKPAD_ACPI_DEBUGFACILITIES THINKPAD_ACPI_DEBUG THINKPAD_ACPI_UNSAFE_LEDS INTEL_TELEMETRY
			;;
	esac

	# Core
	yconfig SMP EARLY_PRINTK BINFMT_ELF BINFMT_SCRIPT NO_HZ HIGH_RES_TIMERS HZ_300 PREEMPT CC_OPTIMIZE_FOR_SIZE \
		KERNEL_ZSTD HAVE_KERNEL_GZIP HAVE_KERNEL_BZIP2 HAVE_KERNEL_LZMA HAVE_KERNEL_XZ HAVE_KERNEL_LZO HAVE_KERNEL_LZ4 \
		RD_GZIP RD_BZIP2 RD_LZMA RD_XZ RD_LZO RD_LZ4 RD_ZSTD MAGIC_SYSRQ ZRAM_WRITEBACK STAGING SUSPEND HIBERNATION FB_VESA \
		ZSWAP ZPOOL ZBUD Z3FOLD ZSMALLOC SCHED_AUTOGROUP ADVISE_SYSCALLS ANON_INODES AUDIT AUDITSYSCALL \
		AUTOFS4_FS BINFMT_ELF BINFMT_SCRIPT BLK_CGROUP BOOT_PRINTK_DELAY BPF_EVENTS BPF_SYSCALL BTRFS_FS_POSIX_ACL CFQ_GROUP_IOSCHED \
		CFS_BANDWIDTH CGROUP_CPUACCT CGROUP_DEVICE CGROUP_FREEZER CGROUP_HUGETLB CGROUP_NET_PRIO CGROUP_PERF CGROUP_PIDS CGROUP_SCHED CGROUPS \
		CHECKPOINT_RESTORE CPUSETS CRYPTO_HMAC CRYPTO_SHA256 CRYPTO_USER_API_HASH DEBUG_INFO DEVTMPFS DMIID EPOLL EVENTFD \
		FAIR_GROUP_SCHED FANOTIFY FHANDLE FSNOTIFY FUNCTION_TRACER INET INOTIFY_USER \
		IPC_NS KEYS LEGACY_VSYSCALL_EMULATE MEMCG MEMCG_SWAP MEMCG_SWAP_ENABLED NAMESPACES NET NET_NS \
		NLATTR PID_NS POSIX_MQUEUE PROC_FS RT_GROUP_SCHED SCHED_DEBUG SCHEDSTATS SECCOMP SECCOMP_FILTER SHMEM SIGNALFD \
		SYSVIPC TIMERFD TRANSPARENT_HUGEPAGE TRANSPARENT_HUGEPAGE_ALWAYS UNIX USER_NS UTS_NS RTC_DRV_CMOS \
		PARPORT_PC_FIFO PARPORT_PC_SUPERIO PARPORT_1284 PARPORT_NOT_PC HDMI KSM UKSM FW_LOADER \
		XEN_BLKDEV_FRONTEND XEN_BLKDEV_BACKEND IXGBEVF SCHED_BMQ LIVEPATCH \
		SLAB HPET COMPACTION MIGRATION MEMORY_HOTPLUG MEMORY_HOTREMOVE BIG_KEYS KEY_DH_OPERATIONS
	mconfig BCACHE ZRAM NET_CLS_CGROUP MEDIA_SUPPORT MEDIA_TUNER PARPORT PARPORT_PC PARPORT_SERIAL PARPORT_AX88796 \
		MEDIA_USB_SUPPORT MEDIA_PCI_SUPPORT
	nconfig EMBEDDED ZRAM_MEMORY_TRACKING MMC_DEBUG HIBERNATION SYSFS_DEPRECATED FW_LOADER_USER_HELPER KERNEL_GZIP \
		BCACHE_DEBUG BCACHE_CLOSURES_DEBUG SLUB SLOB MQ_IOSCHED_DEADLINE MQ_IOSCHED_KYBER

	strconfig DEFAULT_HOSTNAME localhost
	strconfig LOCALVERSION -lfs
	strconfig UEVENT_HELPER_PATH ""
	strconfig EXTRA_FIRMWARE_DIR "/lib/firmware"
	varconfig HZ 300

	# Modules
	yconfig MODULES MODULE_FORCE_LOAD MODULE_UNLOAD MODULE_FORCE_UNLOAD MODULE_SRCVERSION_ALL MODULE_SIG MODULE_SIG_ALL \
		MODULE_SIG_SHA1 MODULE_COMPRESS MODULE_COMPRESS_ZSTD
	nconfig MODULE_COMPRESS_GZIP MODULE_SIG_SHA512 MODULE_SIG_FORCE
	strconfig MODULE_SIG_HASH "sha1"

	# blk
	yconfig BLOCK BLOCK BLK_DEV BLK_DEV_INITRD BLK_DEV_LOOP BLK_RQ_ALLOC_TIME BLK_DEV_BSG BLK_WBT BLK_WBT_SQ BLK_WBT_MQ BLK_CGROUP BLK_DEV_INTEGRITY \
		BLK_DEV_ZONED BLK_DEV_THROTTLING BLK_DEV_RAM VIRTIO_BLK BLK_DEV_SD BLK_DEV_SR CHR_DEV_SG BLK_DEV_MD BLK_DEV_DM_BUILTIN \
		BLK_DEV_3W_XXXX_RAI
	mconfig BLK_DEV_UMEM BLK_DEV_CRYPTOLOOP CHR_DEV_ST CHR_DEV_SCH BLK_DEV_DM BLK_DEV_PMEM

	# LVM, ISCSI, MDADM
	yconfig MD MD_LINEAR MD_AUTODETECT MD_RAID0 MD_RAID1 MD_RAID10 MD_RAID456 DM_UEVENT DM_VERITY_VERIFY_ROOTHASH_SIG DM_VERITY_FEC \
		FUSION FUSION_SPI FUSION_FC FUSION_SAS FUSION_CTL FUSION_LAN ISCSI_IBFT_FIND ISCSI_BOOT_SYSFS
	mconfig MD_MULTIPATH MD_FAULTY MD_CLUSTER DM_BIO_PRISON DM_PERSISTENT_DATA DM_UNSTRIPED DM_CRYPT DM_SNAPSHOT DM_THIN_PROVISIONING DM_CACHE \
		DM_CACHE_SMQ DM_WRITECACHE DM_ERA DM_CLONE DM_MIRROR DM_LOG_USERSPACE DM_RAID DM_ZERO DM_MULTIPATH DM_MULTIPATH_QL DM_MULTIPATH_ST \
		DM_DELAY DM_DUST DM_FLAKEY DM_VERITY DM_SWITCH DM_LOG_WRITES DM_INTEGRITY DM_ZONED CONFIG_TARGET_CORE TCM_IBLOCK TCM_FILEIO TCM_PSCSI \
		TCM_USER2 LOOPBACK_TARGET TCM_FC ISCSI_TARGET SCSI_TARGET_CXGB4 SBP_TARGET ISCSI_IBFT ISCSI_TCP
	nconfig DM_DEBUG_BLOCK_MANAGER_LOCKING FUSION_LOGGING
	varconfig FUSION_MAX_SGE 128

	# Crypto
	yconfig CRYPTO CRYPTO_ALGAPI CRYPTO_ALGAPI2 CRYPTO_AEAD CRYPTO_AEAD2 CRYPTO_BLKCIPHER CRYPTO_BLKCIPHER2 CRYPTO_HASH CRYPTO_HASH2 CRYPTO_RNG \
		CRYPTO_RNG2 CRYPTO_RNG_DEFAULT CRYPTO_AKCIPHER2 CRYPTO_AKCIPHER CRYPTO_KPP2 CRYPTO_KPP CRYPTO_ACOMP2 CRYPTO_MANAGER CRYPTO_MANAGER2 \
		CRYPTO_MANAGER_DISABLE_TESTS CRYPTO_GF128MUL CRYPTO_NULL CRYPTO_NULL2 CRYPTO_RSA CRYPTO_DH CRYPTO_GCM CRYPTO_LIB_SHA256 CRYPTO_SHA256 \
		CRYPTO_SHA512 CRYPTO_LIB_AES CRYPTO_AES CRYPTO_CTR CRYPTO_CTS CRYPTO_ECB CRYPTO_SEQIV CRYPTO_CBC CRYPTO_XTS CRYPTO_HMAC CRYPTO_CRCT10DIF \
		CRYPTO_GHASH CRYPTO_MD5 CRYPTO_SHA1 CRYPTO_DRBG_MENU CRYPTO_DRBG_HMAC CRYPTO_DRBG_HASH CRYPTO_DRBG_CTR CRYPTO_DRBG CRYPTO_JITTERENTROPY \
		CRYPTO_ZSTD CRYPTO_LZO CRYPTO_HASH_INFO CRYPTO_HW CRYPTO_DEV_SP_PSP CRYPTO_DEV_CCP_DEBUGFS CRYPTO_DEV_CCP CRYPTO_DEV_SP_CCP CHELSIO_IPSEC_INLINE \
		PKCS7_MESSAGE_PARSER SIGNED_PE_FILE_VERIFICATION X509_CERTIFICATE_PARSER ASYMMETRIC_KEY_TYPE ASYMMETRIC_PUBLIC_KEY_SUBTYPE
	mconfig CRYPTO_USER CRYPTO_PCRYPT CRYPTO_CRYPTD CRYPTO_AUTHENC CRYPTO_TEST CRYPTO_SIMD CRYPTO_ENGINE CRYPTO_ECC CRYPTO_ECDH CRYPTO_ECRDSA CRYPTO_CCM \
		CRYPTO_CHACHA20POLY1305 CRYPTO_AEGIS128 CRYPTO_ECHAINIV CRYPTO_CFB CRYPTO_LRW CRYPTO_OFB CRYPTO_PCBC CRYPTO_KEYWRAP CRYPTO_NHPOLY1305 CRYPTO_ADIANTUM \
		CRYPTO_ESSIV CRYPTO_CMAC CRYPTO_XCBC CRYPTO_VMAC CRYPTO_CRC32C CRYPTO_CRC32C_INTEL CRYPTO_CRC32 CRYPTO_CRC32_PCLMUL CRYPTO_XXHASH CRYPTO_CRCT10DIF_PCLMUL \
		CRYPTO_POLY1305 CRYPTO_MD4 CRYPTO_MICHAEL_MIC CRYPTO_RMD128 CRYPTO_RMD160 CRYPTO_RMD256 CRYPTO_RMD320 CRYPTO_SHA3 CRYPTO_SM3 CRYPTO_STREEBOG CRYPTO_TGR192 \
		CRYPTO_WP512 CRYPTO_GHASH_CLMUL_NI_INTEL CRYPTO_AES_TI CRYPTO_AES_NI_INTEL CRYPTO_ANUBIS CRYPTO_LIB_ARC4 CRYPTO_ARC4 CRYPTO_BLOWFISH CRYPTO_BLOWFISH_COMMON \
		CRYPTO_CAMELLIA CRYPTO_CAST_COMMON CRYPTO_CAST5 CRYPTO_CAST6 CRYPTO_LIB_DES CRYPTO_DES CRYPTO_FCRYPT CRYPTO_KHAZAD CRYPTO_SALSA20 CRYPTO_CHACHA20 CRYPTO_SEED \
		CRYPTO_SERPENT CRYPTO_SM4 CRYPTO_TEA CRYPTO_TWOFISH CRYPTO_TWOFISH_COMMON CRYPTO_DEFLATE CRYPTO_842 CRYPTO_LZ4 CRYPTO_LZ4HC CRYPTO_ANSI_CPRNG CRYPTO_USER_API \
		CRYPTO_USER_API_HASH CRYPTO_USER_API_SKCIPHER CRYPTO_USER_API_RNG CRYPTO_USER_API_AEAD CRYPTO_DEV_PADLOCK CRYPTO_DEV_PADLOCK_AES CRYPTO_DEV_PADLOCK_SHA \
		CRYPTO_DEV_ATMEL_I2C CRYPTO_DEV_ATMEL_ECC CRYPTO_DEV_ATMEL_SHA204A CRYPTO_DEV_CCP_DD CRYPTO_DEV_CCP_CRYPTO CRYPTO_DEV_QAT CRYPTO_DEV_QAT_DH895xCC CRYPTO_DEV_QAT_C3XXX \
		CRYPTO_DEV_QAT_C62X CRYPTO_DEV_QAT_DH895xCCVF CRYPTO_DEV_QAT_C3XXXVF CRYPTO_DEV_QAT_C62XVF CRYPTO_DEV_NITROX CRYPTO_DEV_NITROX_CNN55XX CRYPTO_DEV_CHELSIO \
		CRYPTO_DEV_CHELSIO_TLS CRYPTO_DEV_VIRTIO CRYPTO_DEV_SAFEXCEL CRYPTO_DEV_CCREE ASYMMETRIC_TPM_KEY_SUBTYPE PKCS8_PRIVATE_KEY_PARSER TPM_KEY_PARSER
	nconfig CRYPTO_STATS PKCS7_TEST_KEY

	# Platform specific crypto
	case $BARCH in
		x86_64)
			mconfig CRYPTO_GLUE_HELPER_X86 CRYPTO_AEGIS128_AESNI_SSE2 CRYPTO_NHPOLY1305_SSE2 CRYPTO_SHA1_SSSE3 CRYPTO_SHA256_SSSE3 CRYPTO_SHA512_SSSE3 CRYPTO_NHPOLY1305_AVX2
			;;
	esac
	case $BARCH in
		x86_64)
			mconfig CRYPTO_TWOFISH_X86_64 CRYPTO_TWOFISH_X86_64_3WAY CRYPTO_TWOFISH_AVX_X86_64 CRYPTO_SERPENT_SSE2_X86_64 CRYPTO_SERPENT_AVX_X86_64 \
				CRYPTO_SERPENT_AVX2_X86_64 CRYPTO_CHACHA20_X86_64 CRYPTO_CAMELLIA_X86_64 CRYPTO_CAMELLIA_AESNI_AVX_X86_64 CRYPTO_CAMELLIA_AESNI_AVX2_X86_64 \
				CRYPTO_CAST5_AVX_X86_64 CRYPTO_CAST6_AVX_X86_64 CRYPTO_DES3_EDE_X86_64 CRYPTO_BLOWFISH_X86_64 CRYPTO_POLY1305_X86_64
			;;
		aarch64)
			yconfig ARM64_CRYPTO
			mconfig CRYPTO_SHA256_ARM64 CRYPTO_SHA512_ARM64 CRYPTO_SHA1_ARM64_CE CRYPTO_SHA2_ARM64_CE CRYPTO_SHA512_ARM64_CE \
				CRYPTO_SHA3_ARM64 CRYPTO_SM3_ARM64_CE CRYPTO_SM4_ARM64_CE CRYPTO_GHASH_ARM64_CE CRYPTO_CRCT10DIF_ARM64_CE \
				CRYPTO_AES_ARM64 CRYPTO_AES_ARM64_CE CRYPTO_AES_ARM64_CE_CCM  CRYPTO_AES_ARM64_CE_BLK CRYPTO_AES_ARM64_NEON_BLK
			;;
		armv7hnl|armv5tel)
			yconfig ARM_CRYPTO
			mconfig CRYPTO_AES_ARM64_BS CRYPTO_SHA1_ARM CRYPTO_SHA256_ARM CRYPTO_SHA512_ARM CRYPTO_AES_ARM CRYPTO_SHA1_ARM CRYPTO_AES_ARM
			nconfig CRYPTO_AES_ARM_CE CRYPTO_GHASH_ARM_CE CRYPTO_CRCT10DIF_ARM_CE CRYPTO_CRC32_ARM_CE CRYPTO_SHA1_ARM_CE CRYPTO_SHA2_ARM_CE
			;;
	esac

	# SCSI
	yconfig SCSI SCSI_DMA SCSI_MULTI_LUN SCSI_MOD RAID_ATTRSSCSI_NETLINK SCSI_PROC_FS SCSI_LOWLEVEL SCSI_DPT_I2O SCSI_ADVANSYS SCSI_ARCMSR MEGARAID_NEWGEN MEGARAID_MM \
		MEGARAID_MAILBOX MEGARAID_SAS SCSI_MPT3SAS SCSI_MPT2SAS SCSI_UFS_BSG SCSI_HPTIOP SCSI_BUSLOGIC SCSI_FLASHPOINT SCSI_HPSA SCSI_3W_9XXX SCSI_3W_SAS \
		SCSI_ACARD SCSI_AHA1740 SCSI_AACRAID SCSI_AIC7XXX SCSI_AIC79XX SCSI_AIC94XX CONFIG_LIBFC LIBFCOE FCOE FCOE_FNIC SCSI_DH \
		SCSI_PM8001 SCSI_BFA_FC SCSI_QLOGIC_1280 SCSI_SYM53C8XX_MMIO SCSI_IPR SCSI_STEX SCSI_SYM53C8XX_2 SCSI_GDTH SCSI_ISCI SCSI_IPS SCSI_INITIO \
		SCSI_INIA100 SCSI_DMX3191D SCSI_SCAN_ASYNC
	mconfig SCSI_ENCLOSURE SCSI_BNX2X_FCOE BE2ISCSI SCSI_MVSAS ESAS2R SCSI_SMARTPQI SCSI_UFSHCD SCSI_UFSHCD_PCI SCSI_UFS_DWC_TC_PCI SCSI_UFSHCD_PLATFORM \
		SCSI_UFS_CDNS_PLATFORM SCSI_UFS_DWC_TC_PLATFORM SCSI_MYRB SCSI_MYRS MEGARAID_LEGACY SCSI_ESAS2R SCSI_MVUMI SCSI_CXGB3_ISCSI SCSI_CXGB4_ISCSI \
		SCSI_BNX2_ISCSI SCSI_PPA SCSI_IMM SCSI_QLA_FC TCM_QLA2XXX SCSI_QLA_ISCSI QEDI QEDF SCSI_LPFC SCSI_SIM710 SCSI_DC395x SCSI_AM53C974 SCSI_WD719X \
		SCSI_DEBUG SCSI_VIRTIO SCSI_CHELSIO_FCOE SCSI_DH_RDAC SCSI_DH_HP_SW SCSI_DH_EMC SCSI_DH_ALUA
	nconfig SCSI_CONSTANTS SCSI_LOGGING AIC94XX_DEBUG SCSI_MVSAS_DEBUG SCSI_MVSAS_TASKLET AIC79XX_REG_PRETTY_PRINT AIC79XX_DEBUG_ENABLE \
		AIC7XXX_REG_PRETTY_PRINT AIC7XXX_DEBUG_ENABLE SCSI_LPFC_DEBUG_FS TCM_QLA2XXX_DEBU SCSI_IZIP_EPP16 SCSI_IZIP_SLOW_CTR SCSI_IPR_TRACE \
		SCSI_IPR_DUMP SCSI_SNIC_DEBUG_FS SCSI_FDOMAIN_PCI
	varconfig AIC79XX_CMDS_PER_DEVICE 32
	varconfig AIC79XX_RESET_DELAY_MS 5000
	varconfig AIC79XX_DEBUG_MASK 0
	varconfig AIC7XXX_CMDS_PER_DEVICE 32
	varconfig AIC7XXX_RESET_DELAY_MS 5000
	varconfig AIC7XXX_DEBUG_MASK 0
	varconfig SCSI_MPT2SAS_MAX_SGE 128
	varconfig SCSI_MPT3SAS_MAX_SGE 128
	varconfig SCSI_SYM53C8XX_DMA_ADDRESSING_MODE 1
	varconfig SCSI_SYM53C8XX_DEFAULT_TAGS 16
	varconfig SCSI_SYM53C8XX_MAX_TAGS 64

	# Platform specific SCSI
	case $BARCH in
		x86_64)
			yconfig VMWARE_PVSCSI XEN_SCSI_FRONTEND HYPERV_STORAGE
			;;
	esac

	# SATA, IDE
	yconfig ATA ATA_VERBOSE_ERROR ATA_ACPI SATA_PMP SATA_AHCI SATA_AHCI_PLATFORM SATA_INIC162X SATA_ACARD_AHCI SATA_SIL24 ATA_SFF PDC_ADMA SATA_QSTOR SATA_SX4 \
		ATA_BMDMA ATA_PIIX SATA_DWC_OLD_DMA SATA_MV SATA_NV SATA_PROMISE SATA_SIL SATA_SIS SATA_SVW SATA_ULI SATA_VIA SATA_VITESSE PATA_ALI PATA_AMD PATA_ARTOP \
		PATA_ATIIXP PATA_ATP867X PATA_CMD64X PATA_CYPRESS PATA_EFAR PATA_HPT366 PATA_HPT37X PATA_HPT3X2N PATA_HPT3X3 PATA_HPT3X3_DMA PATA_IT8213 PATA_IT821X \
		PATA_JMICRON PATA_MARVELL PATA_NETCELL PATA_NINJA32 PATA_NS87415 PATA_OLDPIIX PATA_OPTIDMA PATA_RADISYS PATA_RDC PATA_SCH PATA_SERVERWORKS PATA_SIL680 \
		PATA_SIS PATA_TOSHIBA PATA_TRIFLEX PATA_VIA PATA_WINBOND PATA_CMD640_PCI PATA_MPIIX PATA_NS87410 PATA_OPTI PATA_RZ1000 ATA_GENERIC PATA_ACPI PATA_LEGACY
	mconfig PATA_PCMCIA PATA_PDC2027X PATA_PDC_OLD SATA_DWC
	nconfig ATA_PLATFORM SATA_DWC_DEBUG SATA_ZPODD
	varconfig SATA_MOBILE_LPM_POLICY 3

	# NVME
	yconfig NVME_CORE NVME_MULTIPATH
	mconfig NVME_FABRICS NVME_RDMA NVME_FC NVME_TCP NVME_TARGET NVME_TARGET_LOOP NVME_TARGET_RDMA NVME_TARGET_FC NVME_TARGET_FCLOOP NVME_TARGET_TCP

	# SHDCI
	yconfig MMC MMC_SDHCI MMC_SDHCI_PCI MMC_SDHCI_ACPI MMC_SDHCI_PLTFM MMC_RICOH_MMC MMC_SDHCI_IO_ACCESSORS MMC_REALTEK_PCI MMC_REALTEK_USB MMC_CQHCI MMC_TOSHIBA_PCI \
		MMC_MTK MMC_SDHCI_XENON MMC_TIFM_SD MMC_SPI MMC_SDRICOH_CS MMC_CB710 MMC_VIA_SDMMC
	mconfig MMC_SDHCI_F_SDH30 MMC_WBSD MMC_ALCOR MMC_VUB300 MMC_USHC MMC_USDHI6ROL0 MEMSTICK
	nconfig MEMSTICK_DEBUG

	# Platform specific SDHCI
	case $BARCH in
		aarch64|armv7hnl|armv5tel)
			yconfig MMC_ARMMMCI MMC_QCOM_DML MMC_SDHCI_OF_ASPEED MMC_SDHCI_OF_AT91 MMC_SDHCI_CADENCE MMC_SDHCI_ESDHC_IMX \
				MMC_SDHCI_TEGRA MMC_SDHCI_PXAV3 MMC_SDHCI_F_SDH30 MMC_SUNXI MMC_DW MMC_DW_PLTFM MMC_DW_EXYNOS MMC_DW_K3 MMC_DW_PCI MMC_DW_ROCKCHIP
			nconfig MMC_DW_BLUEFIELD MMC_DW_HI3798CV200
			;;
	esac

	# USB
	yconfig USB_UAS USB_SUPPORT USB_COMMON USB_ARCH_HAS_HCD USB USB_ANNOUNCE_NEW_DEVICES \
		USB_C67X00_HCD USB_XHCI_HCD USB_XHCI_DBGCAP USB_XHCI_PCI USB_XHCI_PLATFORM USB_EHCI_HCD USB_EHCI_ROOT_HUB_TT \
		USB_EHCI_TT_NEWSCHED USB_EHCI_PCI USB_EHCI_HCD_PLATFORM USB_OXU210HP_HCD USB_ISP116X_HCD USB_FOTG210_HCD USB_OHCI_HCD \
		USB_OHCI_HCD_PCI USB_OHCI_HCD_SSB USB_OHCI_HCD_PLATFORM USB_UHCI_HCD USB_U132_HCD USB_SL811_HCD USB_SL811_CS USB_R8A66597_HCD \
		USB_WHCI_HCD USB_HWA_HCD USB_HCD_SSB USB_DWCOTG USB_PHY USB_MXS_PHY AMLOGIC_USB USB_DWC_OTG_HCD \
		USB_HOST_ELECT_TEST USB_DEFAULT_PERSIST UCSI MFD_RTSX_USB MMC_REALTEK_USB MEMSTICK_REALTEK_USB USB_MASS_STORAGE \
		U_SERIAL_CONSOLE USB_GADGET MEDIA_USB_SUPPORT INTEL_ISH_HID USB_OHCI_LITTLE_ENDIAN USB_SUPPORT USB_COMMON \
		USB_ARCH_HAS_HCD USB_PCI USB_DEFAULT_PERSIST USB_OTG USB_LEDS_TRIGGER_USBPORT USB_MON USB_WUSB USB_WUSB_CBAF \
		USB_CDNS3 USB_CDNS3_PCI_WRAP USB_CDNS3_GADGET USB_CDNS3_HOST USB4
	mconfig USB_G_SERIAL USB_PRINTER USB4_NET
	nconfig USB_ACM USB_MON USB_HCD_TEST_MODE USB_HCD_BCMA USB_SL811_HCD_ISO USB_WUSB_CBAF_DEBUG \
		USB_OTG_WHITELIST USB_OTG_BLACKLIST_HUB USB_OTG_FSM USB_DYNAMIC_MINORS

	# USB storage drivers
	mconfig USB_STORAGE_REALTEK REALTEK_AUTOPM USB_STORAGE_DATAFAB USB_STORAGE_FREECOM USB_STORAGE_ISD200 \
		USB_STORAGE_USBAT USB_STORAGE_SDDR09 USB_STORAGE_SDDR55 USB_STORAGE_JUMPSHOT USB_STORAGE_ALAUDA \
		USB_STORAGE_ONETOUCH USB_STORAGE_KARMA USB_STORAGE_CYPRESS_ATACB USB_STORAGE_ENE_UB6250
	yconfig USB_STORAGE REALTEK_AUTOPM

	# USB serial drivers
	mconfig USB_USS720 USB_SERIAL USB_SERIAL_SIMPLE USB_SERIAL_AIRCABLE USB_SERIAL_ARK3116 USB_SERIAL_BELKIN \
		USB_SERIAL_CH341 USB_SERIAL_WHITEHEAT USB_SERIAL_DIGI_ACCELEPORT USB_SERIAL_CP210X USB_SERIAL_CYPRESS_M8 \
		USB_SERIAL_EMPEG USB_SERIAL_FTDI_SIO USB_SERIAL_VISOR USB_SERIAL_IPAQ USB_SERIAL_IR USB_SERIAL_EDGEPORT \
		USB_SERIAL_EDGEPORT_TI USB_SERIAL_F81232 USB_SERIAL_F8153X USB_SERIAL_GARMIN USB_SERIAL_IPW USB_SERIAL_IUU \
		USB_SERIAL_KEYSPAN_PDA USB_SERIAL_KEYSPAN USB_SERIAL_KLSI USB_SERIAL_KOBIL_SCT USB_SERIAL_MCT_U232 \
		USB_SERIAL_METRO USB_SERIAL_MOS7720  USB_SERIAL_MOS7840 USB_SERIAL_MXUPORT \
		USB_SERIAL_NAVMAN USB_SERIAL_PL2303 USB_SERIAL_OTI6858 USB_SERIAL_QCAUX USB_SERIAL_QUALCOMM \
		USB_SERIAL_SPCP8X5 USB_SERIAL_SAFE USB_SERIAL_SIERRAWIRELESS USB_SERIAL_SYMBO USB_SERIAL_TI \
		USB_SERIAL_CYBERJACK USB_SERIAL_XIRCOM USB_SERIAL_WWAN USB_SERIAL_OPTION USB_SERIAL_OMNINET \
		USB_SERIAL_OPTICON USB_SERIAL_XSENS_MT USB_SERIAL_WISHBONE USB_SERIAL_SSU100 USB_SERIAL_QT2 \
		USB_SERIAL_UPD78F0730 USB_SERIAL_DEBUG

	# USB misc
	mconfig USB_EMI62 USB_EMI26 USB_ADUTUX USB_SEVSEG USB_RIO500 _USB_LEGOTOWER USB_LCD USB_CYPRESS_CY7C63 USB_CYTHERM USB_IDMOUSE \
		USB_FTDI_ELAN USB_APPLEDISPLAY USB_SISUSBVGA  USB_LD USB_TRANCEVIBRATOR USB_IOWARRIOR USB_TEST \
		USB_EHSET_TEST_FIXTURE USB_ISIGHTFW USB_YUREX USB_EZUSB_FX2 USB_HUB_USB251XB USB_HSIC_USB3503 USB_HSIC_USB4604 \
		USB_LINK_LAYER_TEST USB_CHAOSKEY USB_ATM USB_SPEEDTOUCH USB_CXACRU USB_UEAGLEATM USB_XUSBATM \
		SB_GR_UDC USB_R8A66597 USB_PXA27X USB_MV_UDC USB_MV_U3D USB_SNP_CORE USB_SNP_UDC_PLAT USB_M66592 \
		USB_BDC_UDC USB_BDC_PCI USB_AMD5536UDC USB_NET2272 USB_NET2280 USB_GOKU \
		USB_EG20T USB_GADGET_XILINX USB_DUMMY_HCD USB_LIBCOMPOSITE USB_F_ACM USB_F_SS_LB \
		USB_U_SERIAL USB_U_ETHER USB_U_AUDIO USB_F_SERIAL USB_F_OBEX USB_F_NCM USB_F_ECM \
		USB_F_PHONET USB_F_EEM USB_F_SUBSET USB_F_RNDIS USB_F_MASS_STORAGE USB_F_FS \
		USB_F_UAC1 USB_F_UAC1_LEGACY USB_F_UAC2 USB_F_UVC USB_F_MIDI USB_F_HID USB_F_PRINTER \
		USB_F_TCM USB_CONFIGFS USB_ZERO USB_AUDIO USB_ETH \
		USB_G_NCM USB_GADGETFS USB_FUNCTIONFS USB_MASS_STORAGE USB_GADGET_TARGET USB_G_SERIAL \
		USB_MIDI_GADGET USB_G_PRINTER USB_CDC_COMPOSITE USB_G_NOKIA USB_G_ACM_MS USB_G_MULTI \
		USB_G_MULTI_RNDIS USB_G_HID USB_G_DBGP \
		USB_G_WEBCAM UCSI_CCG UCSI_ACPI USB_ROLES_INTEL_XHCI USB_ULPI_BUS \
		UWB UWB_HWA UWB_WHCI UWB_I1480U PWRSEQ_EMMC PWRSEQ_SD8787 PWRSEQ_SIMPLE USB_MDC800 USB_MICROTEK \
		USBIP_CORE USB_MUSB_HDRC USB_DWC3 USB_DWC2 USB_CHIPIDEA USB_ISP1760
	yconfig USB_CONFIGFS_SERIAL USB_CONFIGFS_ACM USB_CONFIGFS_OBEX USB_CONFIGFS_NCM USB_CONFIGFS_ECM \
		USB_CONFIGFS_ECM_SUBSET USB_CONFIGFS_RNDIS USB_CONFIGFS_EEM USB_CONFIGFS_PHONET USB_CONFIGFS_MASS_STORAGE \
		USB_CONFIGFS_F_LB_SS USB_CONFIGFS_F_FS USB_CONFIGFS_F_UAC1 USB_CONFIGFS_F_UAC1_LEGACY USB_CONFIGFS_F_UAC2 \
		USB_CONFIGFS_F_MIDI USB_CONFIGFS_F_HID USB_CONFIGFS_F_UVC USB_CONFIGFS_F_PRINTER USB_CONFIGFS_F_TCM \
		USB_ROLE_SWITCH USB_LED_TRIG USB_SERIAL_GENERIC USB_SERIAL_MOS7715_PARPORT USB_SISUSBVGA_CON USB_NET2272_DMA \
		USB_ETH_RNDIS USB_ETH_EEM USB_FUNCTIONFS_ETH USB_FUNCTIONFS_RNDIS USB_FUNCTIONFS_GENERIC USB_G_MULTI_RNDIS \
		USB_G_MULTI_CDC USB_G_DBGP_SERIAL
	nconfig USB_G_DBGP_PRINTK GADGET_UAC1 USB_GADGET_UAC1 USBIP_DEBUG

	# TypeC support
	yconfig TYPEC TYPEC_TCPM TYPEC_TCPCI TYPEC_RT1711H TYPEC_FUSB302 TYPEC_WCOVE TYPEC_UCSI UCSI_CCG UCSI_ACPI
	mconfig TYPEC_TPS6598X TYPEC_MUX_PI3USB30532 TYPEC_DP_ALTMODE TYPEC_NVIDIA_ALTMODE

	# IEEE 1394 support (x86 and ppc)
	case $BARCH in
		x86_64|ppc64le|ppc64|ppc)
			yconfig MACINTOSH_DRIVERS
			;;
	esac

	# Partition type support
	yconfig PARTITION_ADVANCED EFI_PARTITION  SGI_PARTITION SUN_PARTITION MAC_PARTITION
	nconfig KARMA_PARTITION AMIGA_PARTITION OSF_PARTITION

	# Filesystems support
	yconfig FS_POSIX_ACL EXPORTFS FILE_LOCKING MANDATORY_FILE_LOCKING FS_ENCRYPTION FSNOTIFY DNOTIFY INOTIFY_USER FANOTIFY \
		GENERIC_ACL SYSCTL POSIX_MQUEUE POSIX_MQUEUE_SYSCTL KERNFS SYSFS TMPFS TMPFS_POSIX_ACL TMPFS_XATTR CONFIGFS_FS MISC_FILESYSTEMS \
		NETWORK_FILESYSTEMS TIMERSTATS EXT4_FS EXT4_USE_FOR_EXT2 EXT4_FS_POSIX_ACL EXT4_FS_SECURITY JBD2 FS_MBCACHE REISERFS_FS_XATTR \
		REISERFS_FS_POSIX_ACL REISERFS_FS_SECURITY JFS_POSIX_ACL JFS_SECURITY XFS_QUOTA XFS_POSIX_ACL XFS_RT XFS_ONLINE_SCRUB OCFS2_DEBUG_MASKLOG \
		BTRFS_FS BTRFS_FS_POSIX_ACL F2FS_STAT_FS F2FS_FS_XATTR F2FS_FS_POSIX_ACL EXFAT_DONT_MOUNT_VFAT EXFAT_DISCARD FUSE_FS VIRTIO_FS \
		OVERLAY_FS OVERLAY_FS_REDIRECT_ALWAYS_FOLLOW OVERLAY_FS_XINO_AUTO FSCACHE_STATS ISO9660_FS JOLIET ZISOFS UDF_FS \
		SQUASHFS SQUASHFS_FILE_DIRECT SQUASHFS_DECOMP_MULTI SQUASHFS_XATTR SQUASHFS_ZLIB SQUASHFS_LZ4 SQUASHFS_LZO SQUASHFS_XZ SQUASHFS_ZSTD \
		SUNRPC_BACKCHANNEL SUNRPC_SWAP SUNRPC_DISABLE_INSECURE_ENCTYPES SUNRPC_DEBUG 9P_FS 9P_FSCACHE 9P_FS_POSIX_ACL 9P_FS_SECURITY \
		CIFS_STATS CIFS_STATS2 CIFS_SMB2 CIFS_SMB311 CIFS_FSCACHE NFS_V2 NFS_V3 NFS_V4 NFS_SWAP NFS_V4_1 NFS_V4_2 PNFS_FILE_LAYOUT NFS_V4_1_MIGRATION \
		ROOT_NFS NFS_USE_KERNEL_DNS GRACE_PERIOD LOCKD LOCKD_V4 NFS_COMMON UBIFS_FS UBIFS_FS_LZO UBIFS_FS_ZLIB FAT_FS MSDOS_FS VFAT_FS FAT_DEFAULT_UTF8 \
		NTFS_RW CEPH_FSCACHE CEPH_FS_POSIX_ACL CEPH_FS_SECURITY_LABEL FS_VERITY
	mconfig RPCSEC_GSS_KRB5 PNFS_FLEXFILE_LAYOUT NFS_FS HFS_FS HFSPLUS_FS CIFS SUNRPC_XPRT_RDMA RPCSEC_GSS_KRB5 SUNRPC SUNRPC_GSS FSCACHE STAGING_EXFAT_FS \
		NILFS2_FS F2FS_FS GFS2_FS OCFS2_FS OCFS2_FS_O2CB OCFS2_FS_USERSPACE_CLUSTER REISERFS_FS JFS_FS XFS_FS CACHEFILES NTFS_FS CEPH_FS ZONEFS_FS
	nconfig EXT4_DEBUG JBD2_DEBUG REISERFS_CHECK REISERFS_PROC_INFO JFS_DEBUG JFS_STATISTICS XFS_ONLINE_REPAIR XFS_WARN XFS_DEBUG \
		OCFS2_FS_STATS OCFS2_DEBUG_FS BTRFS_FS_CHECK_INTEGRITY BTRFS_FS_RUN_SANITY_TESTS BTRFS_DEBUG BTRFS_ASSERT BTRFS_FS_REF_VERIFY F2FS_FS_SECURITY \
		F2FS_CHECK_FS F2FS_IO_TRACE F2FS_FAULT_INJECTION EXFAT_DELAYED_SYNC EXFAT_KERNEL_DEBUG EXFAT_DEBUG_MSG OVERLAY_FS_REDIRECT_DIR OVERLAY_FS_INDEX \
		OVERLAY_FS_METACOPY FSCACHE_HISTOGRAM FSCACHE_DEBUG FSCACHE_OBJECT_LIST CACHEFILES_DEBUG CACHEFILES_HISTOGRAM SQUASHFS_FILE_CACHE SQUASHFS_DECOMP_SINGLE \
		SQUASHFS_DECOMP_MULTI_PERCPU SQUASHFS_4K_DEVBLK_SIZE SQUASHFS_EMBEDDED CIFS_WEAK_PW_HASH CIFS_UPCALL CIFS_XATTR CIFS_DEBUG CIFS_DEBUG2 CIFS_DFS_UPCALL NFS_V3_ACL \
		NFS_USE_LEGACY_DNS NFSD NTFS_DEBUG
	strconfig FAT_DEFAULT_IOCHARSET "utf8"
	strconfig EXFAT_DEFAULT_IOCHARSET "utf8"
	strconfig NFS_V4_1_IMPLEMENTATION_ID_DOMAIN "kernel.org"
	varconfig FAT_DEFAULT_CODEPAGE 437
	varconfig EXFAT_DEFAULT_CODEPAGE 437
	varconfig SQUASHFS_FRAGMENT_CACHE_SIZE 3

	# Charset support
	yconfig NLS NLS_CODEPAGE_437 NLS_UTF8 UNICODE
	mconfig NLS_CODEPAGE_737 NLS_CODEPAGE_775 NLS_CODEPAGE_850 NLS_CODEPAGE_852 NLS_CODEPAGE_855 NLS_CODEPAGE_857 NLS_CODEPAGE_860 NLS_CODEPAGE_861 \
		NLS_CODEPAGE_862 NLS_CODEPAGE_863 NLS_CODEPAGE_864 NLS_CODEPAGE_865 NLS_CODEPAGE_866 NLS_CODEPAGE_869 NLS_CODEPAGE_936 NLS_CODEPAGE_950 NLS_CODEPAGE_932 \
		NLS_CODEPAGE_949 NLS_CODEPAGE_874 NLS_ISO8859_8 NLS_CODEPAGE_1250 NLS_CODEPAGE_1251 NLS_ASCII NLS_ISO8859_1 NLS_ISO8859_2 NLS_ISO8859_3 NLS_ISO8859_4 \
		NLS_ISO8859_5 NLS_ISO8859_6 NLS_ISO8859_7 NLS_ISO8859_9 NLS_ISO8859_13 NLS_ISO8859_14 NLS_ISO8859_15 NLS_KOI8_R NLS_KOI8_U NLS_MAC_ROMAN NLS_MAC_CELTIC \
		NLS_MAC_CENTEURO NLS_MAC_CROATIAN NLS_MAC_CYRILLIC NLS_MAC_GAELIC NLS_MAC_GREEK NLS_MAC_ICELAND NLS_MAC_INUIT NLS_MAC_ROMANIAN NLS_MAC_TURKISH DLM
	nconfig UNICODE_NORMALIZATION_SELFTEST DLM_DEBUG
	strconfig NLS_DEFAULT "utf8"

	# Basic input support
	yconfig INPUT INPUT_LEDS INPUT_FF_MEMLESS INPUT_KEYBOARD KEYBOARD_ATKBD INPUT_MOUSEDEV INPUT_MOUSE MOUSE_PS2_BYD MOUSE_PS2_LOGIPS2PP MOUSE_PS2_SYNAPTICS \
		MOUSE_PS2_SYNAPTICS_SMBUS MOUSE_PS2_CYPRESS MOUSE_PS2_LIFEBOOK MOUSE_PS2_TRACKPOINT MOUSE_PS2_ELANTECH MOUSE_PS2_ELANTECH_SMBUS MOUSE_PS2_SENTELIC \
		MOUSE_PS2_TOUCHKIT MOUSE_PS2_FOCALTECH MOUSE_PS2_VMMOUSE MOUSE_PS2_SMBUS MOUSE_ELAN_I2C_I2C MOUSE_ELAN_I2C_SMBUS INPUT_EVDEV INPUT_MISC INPUT_UINPUT INPUT_JOYSTICK
	mconfig INPUT_POLLDEV KEYBOARD_GPIO KEYBOARD_GPIO_POLLED KEYBOARD_ADC KEYBOARD_ADP5520 KEYBOARD_ADP5588 KEYBOARD_ADP5589 KEYBOARD_APPLESPI KEYBOARD_QT1050 \
		KEYBOARD_QT1070 KEYBOARD_QT2160 KEYBOARD_DLINK_DIR685 KEYBOARD_LKKBD KEYBOARD_GPIO KEYBOARD_GPIO_POLLED KEYBOARD_TCA6416 KEYBOARD_TCA8418 KEYBOARD_MATRIX \
		KEYBOARD_LM8323 KEYBOARD_LM8333 KEYBOARD_MAX7359 KEYBOARD_MCS KEYBOARD_MPR121 KEYBOARD_NEWTON KEYBOARD_OPENCORES KEYBOARD_SAMSUNG KEYBOARD_STOWAWAY \
		KEYBOARD_SUNKBD KEYBOARD_TM2_TOUCHKEY KEYBOARD_TWL4030 KEYBOARD_XTKBD KEYBOARD_CROS_EC KEYBOARD_MTK_PMIC MOUSE_PS2 INPUT_JOYDEV MOUSE_SERIAL MOUSE_APPLETOUCH \
		MOUSE_BCM5974 MOUSE_CYAPA MOUSE_ELAN_I2C MOUSE_VSXXXAA MOUSE_GPIO MOUSE_SYNAPTICS_I2C MOUSE_SYNAPTICS_USB VIRTIO_INPUT
	nconfig SERIO

	# Misc input drivers
	mconfig INPUT_AD714X INPUT_AD714X_I2C INPUT_BMA150 INPUT_E3X0_BUTTON INPUT_PCSPKR INPUT_MC13783_PWRBUTTON \
		INPUT_MMA8450 INPUT_APANEL INPUT_GP2A INPUT_GPIO_BEEPER INPUT_GPIO_DECODER INPUT_ATLAS_BTNS INPUT_ATI_REMOTE2 \
		INPUT_KEYSPAN_REMOTE INPUT_KXTJ9 INPUT_POWERMATE INPUT_YEALINK INPUT_CM109 \
		INPUT_REGULATOR_HAPTIC INPUT_RETU_PWRBUTTON INPUT_UINPUT INPUT_PCF50633_PMU INPUT_PCF8574 INPUT_GPIO_ROTARY_ENCODER \
		INPUT_ADXL34X INPUT_ADXL34X_I2C INPUT_IMS_PCU INPUT_CMA3000 INPUT_CMA3000_I2C INPUT_IDEAPAD_SLIDEBAR \
		INPUT_SOC_BUTTON_ARRAY INPUT_DRV260X_HAPTICS INPUT_DRV2665_HAPTICS INPUT_DRV2667_HAPTICS
	yconfig INPUT_KXTJ9_POLLED_MODE

	# HID support
	yconfig HID HIDRAW UHID HID_GENERIC USB_HID HID_PID USB_HIDDEV NEW_LEDS LEDS_CLASS \
		HID_ACRUX_FF DRAGONRISE_FF HOLTEK_FF LOGITECH_FF LOGIRUMBLEPAD2_FF LOGIG940_FF LOGIWHEELS_FF PANTHERLORD_FF HID_PICOLCD_FB HID_PICOLCD_BACKLIGHT HID_PICOLCD_LCD \
		HID_PICOLCD_LEDS HID_PICOLCD_CIR SONY_FF GREENASIA_FF SMARTJOYPLUS_FF THRUSTMASTER_FF ZEROPLUS_FF
	mconfig I2C_HID HID_A4TECH HID_ACCUTOUCH HID_ACRUX HID_APPLE HID_APPLEIR HID_ASUS HID_AUREAL HID_BELKIN HID_BETOP_FF HID_BIGBEN_FF HID_CHERRY HID_CHICONY HID_CORSAIR \
		HID_COUGAR HID_MACALLY HID_PRODIKEYS HID_CMEDIA HID_CP2112 HID_CREATIVE_SB0540 HID_CYPRESS HID_DRAGONRISE HID_EMS_FF HID_ELAN HID_ELECOM HID_ELO HID_EZKEY \
		HID_GEMBIRD HID_GFRM HID_HOLTEK HID_GT683R HID_KEYTOUCH HID_KYE HID_UCLOGIC HID_WALTOP HID_VIEWSONIC HID_GYRATION HID_ICADE HID_ITE HID_JABRA \
		HID_TWINHAN HID_KENSINGTON HID_LCPOWER HID_LED HID_LENOVO HID_LOGITECH HID_LOGITECH_DJ HID_LOGITECH_HIDPP HID_MAGICMOUSE HID_MALTRON HID_MAYFLASH HID_REDRAGON \
		HID_MICROSOFT HID_MONTEREY HID_MULTITOUCH HID_NTI HID_NTRIG HID_ORTEK HID_PANTHERLORD HID_PENMOUNT HID_PETALYNX HID_PICOLCD HID_PLANTRONICS HID_PRIMAX HID_RETRODE \
		HID_SAMSUNG HID_SONY HID_SPEEDLINK HID_STEAM HID_STEELSERIES HID_SUNPLUS HID_RMI HID_GREENASIA HID_HYPERV_MOUSE HID_SMARTJOYPLUS HID_TIVO \
		HID_TOPSEED HID_THINGM HID_THRUSTMASTER HID_UDRAW_PS3 HID_U2FZERO HID_WACOM HID_WIIMOTE HID_XINMO HID_ZEROPLUS HID_ZYDACRON HID_SENSOR_HUB HID_ALPS
	nconfig HID_SENSOR_CUSTOM_SENSOR

	# Platform specific HID support
	case $BARCH in
		x86_64)
			mconfig INTEL_ISH_HID
			;;
	esac

	# Networking support
	yconfig BPF_JIT BQL BRIDGE_IGMP_SNOOPING CFG80211_WEXT DEFAULT_CUBIC DNS_RESOLVER DST_CACHE HAVE_NET_DSA INET_DIAG_DESTROY INET_LRO INET IP_ADVANCED_ROUTER \
		IP_MROUTE_COMMON IP_MROUTE_MULTIPLE_TABLES IP_MROUTE IP_MULTICAST IP_MULTIPLE_TABLES IP_PIMSM_V1 IP_PIMSM_V2 IP_ROUTE_CLASSID IP_ROUTE_MULTIPATH \
		IP_ROUTE_VERBOSE IPV6_MROUTE_MULTIPLE_TABLES IPV6_MROUTE IPV6_MULTIPLE_TABLES IPV6_NDISC_NODETYPE IPV6_OPTIMISTIC_DAD IPV6_PIMSM_V2 IPV6_ROUTE_INFO \
		IPV6_ROUTER_PREF IPV6_SEG6_BPF IPV6_SEG6_HMAC IPV6_SEG6_LWTUNNEL IPV6_SIT_6RD IPV6_SUBTREES IPV6 MAY_USE_DEVLINK NET_FLOW_LIMIT NET_FOU_IP_TUNNELS \
		NET_KEY_MIGRATE NET_L3_MASTER_DEV NET_PTP_CLASSIFY NET_RX_BUSY_POLL NET_SCHED NET NETDEVICES NETFILTER_ADVANCED NETFILTER NETLABEL \
		NETWORK_PHY_TIMESTAMPING NETWORK_SECMARK OF_NET PACKET RFKILL_LEDS RFKILL_PM RFS_ACCEL RPS SYN_COOKIES TCP_CONG_ADVANCED TCP_CONG_CUBIC UNIX \
		WEXT_CORE WEXT_PRIV WIRELESS_EXT WIRELESS WIRELSS WLAN XDP_SOCKETS_DIAG XDP_SOCKETS XFRM_MIGRATE XFRM_OFFLOAD XFRM_STATISTICS XFRM_SUB_POLICY XFRM XPS \
		BRIDGE_IGMP_SNOOPING BRIDGE_VLAN_FILTERING NET_CLS_ACT NET_EMATCH SCTP_DEFAULT_COOKIE_HMAC_SHA1 SCTP_COOKIE_HMAC_MD5 SCTP_COOKIE_HMAC_SHA1 TIPC_MEDIA_IB \
		TIPC_MEDIA_UDP VLAN_8021Q_GVRP VLAN_8021Q_MVRP L2TP_V3 IEEE802154_NL802154_EXPERIMENTAL NET_SCHED NET_SCH_FQ_CODEL NET_SCH_DEFAULT DEFAULT_FQ_CODEL \
		NET_CLS CLS_U32_PERF CLS_U32_MARK GACT_PROB NET_TC_SKB_EXT NET_SCH_FIFO DCB MPLS NET_SWITCHDEV NET_L3_MASTER_DEV NET_NCSI NCSI_OEM_CMD_GET_MAC RPS \
		RFS_ACCEL CGROUP_NET_PRIO CGROUP_NET_CLASSID NET_RX_BUSY_POLL BQL BPF_STREAM_PARSER NET_FLOW_LIMIT PPP_FILTER PPP_MULTILINK SLIP_COMPRESSED \
		SLIP_SMART SLIP_MODE_SLIP6 NETDEVICES NET_CORE NET_FC IPVLAN_L3S NETCONSOLE_DYNAMIC NETPOLL NET_POLL_CONTROLLER ISDN_PPP_VJ ISDN_MPP ISDN_DRV_AVMB1_B1PCIV4 ISDN_CAPI_MIDDLEWARE \
		ISDN ISDN_PPP ISDN_AUDIO ISDN_TTY_FAX ISDN_PPP_VJ ISDN_MPP ISDN_DIVAS_BRIPCI ISDN_DIVAS_PRIPCI DEFAULT_SFQ DEFAULT_PFIFO_FAST DEFAULT_FQ DEFAULT_CODEL \
		SCTP_DBG_OBJCNT SCTP_DEFAULT_COOKIE_HMAC_MD5 SCTP_DEFAULT_COOKIE_HMAC_NONE NETFILTER_EGRESS
	mconfig BONDING BRIDGE_NETFILTER BRIDGE CFG80211 DUMMY INET_AH INET_DIAG INET_ESP_OFFLOAD INET_ESP INET_IPCOMP INET_RAW_DIAG INET_TCP_DIAG INET_TUNNEL INET_UDP_DIAG \
		INET_XFRM_TUNNEL INET6_AH INET6_ESP_OFFLOAD INET6_ESP INET6_IPCOMP INET6_TUNNEL INET6_XFRM_TUNNEL IP_VS IPV6_FOU_TUNNEL IPV6_FOU IPV6_GRE IPV6_ILA IPV6_MIP6 \
		IPV6_SIT NET_FOU NET_IP_TUNNEL NET_IPGRE_DEMUX NET_IPGRE NET_IPIP NET_IPVTI IPV6_TUNNEL IPV6_VTI IPVLAN LLC MAC80211 MACVLAN NET_KEY NET_UDP_TUNNEL SMC_DIAG \
		SMC STP TCP_CONG_BBR TCP_CONG_BIC TCP_CONG_CDG TCP_CONG_DCTCP TCP_CONG_HSTCP TCP_CONG_HTCP TCP_CONG_HYBLA TCP_CONG_ILLINOIS TCP_CONG_LP TCP_CONG_NV TCP_CONG_SCALABLE \
		TCP_CONG_VEGAS TCP_CONG_VENO TCP_CONG_WESTWOOD TCP_CONG_YEAH VLAN_8021Q VXLAN XFRM_ALGO XFRM_INTERFACE XFRM_IPCOMP XFRM_USER LIB80211 RFKILL VIRTIO_NET ATALK X25 LAPB L2TP_DEBUGFS \
		IP_SCTP INET_SCTP_DIAG RDS RDS_RDMA RDS_TCP TIPC TIPC_DIAG VLAN_8021Q LLC LLC2 PHONET L2TP L2TP_IP L2TP_ETH IEEE802154 IEEE802154_SOCKET IEEE802154_6LOWPAN MAC802154 \
		NET_SCH_CBQ NET_SCH_HTB NET_SCH_HFSC NET_SCH_ATM NET_SCH_PRIO NET_SCH_MULTIQ NET_SCH_RED NET_SCH_SFB NET_SCH_SFQ NET_SCH_TEQL NET_SCH_TBF NET_SCH_CBS NET_SCH_ETF NET_SCH_TAPRIO \
		NET_SCH_GRED NET_SCH_DSMARK NET_SCH_NETEM NET_SCH_DRR NET_SCH_MQPRIO NET_SCH_SKBPRIO NET_SCH_CHOKE NET_SCH_QFQ NET_SCH_CODEL NET_SCH_CAKE NET_SCH_FQ NET_SCH_HHF NET_SCH_PIE \
		NET_SCH_INGRESS NET_SCH_PLUG NET_CLS_BASIC NET_CLS_TCINDEX NET_CLS_ROUTE4 NET_CLS_FW NET_CLS_U32 NET_CLS_RSVP NET_CLS_RSVP6 NET_CLS_FLOW NET_CLS_CGROUP NET_CLS_BPF \
		NET_CLS_FLOWER NET_CLS_MATCHALL NET_EMATCH_CMP NET_EMATCH_NBYTE NET_EMATCH_U32 NET_EMATCH_META NET_EMATCH_TEXT NET_EMATCH_CANID NET_EMATCH_IPSET NET_EMATCH_IPT \
		NET_ACT_POLICE NET_ACT_GACT NET_ACT_MIRRED NET_ACT_SAMPLE NET_ACT_IPT NET_ACT_NAT NET_ACT_PEDIT NET_ACT_SIMP NET_ACT_SKBEDIT NET_ACT_CSUM NET_ACT_MPLS NET_ACT_VLAN \
		NET_ACT_BPF NET_ACT_CONNMARK NET_ACT_CTINFO NET_ACT_SKBMOD NET_ACT_IFE NET_ACT_TUNNEL_KEY NET_ACT_CT NET_IFE_SKBMARK NET_IFE_SKBPRIO NET_IFE_SKBTCINDEX DNS_RESOLVER \
		OPENVSWITCH OPENVSWITCH_GRE OPENVSWITCH_VXLAN OPENVSWITCH_GENEVE VSOCKETS VSOCKETS_DIAG VMWARE_VMCI_VSOCKETS VIRTIO_VSOCKETS VIRTIO_VSOCKETS_COMMON HYPERV_VSOCKETS \
		NETLINK_DIAG NET_MPLS_GSO MPLS_ROUTING MPLS_IPTUNNEL NET_NSH HSR PLIP PPP PPP_BSDCOMP PPP_DEFLATE PPP_MPPE PPPOATM PPPOE PPTP PPPOL2TP PPP_ASYNC PPP_SYNC_TTY SLIP \
		SLHC MAC_EMUMOUSEBTN MII DUMMY EQUALIZER IFB NET_TEAM NET_TEAM_MODE_BROADCAST NET_TEAM_MODE_ROUNDROBIN NET_TEAM_MODE_RANDOM NET_TEAM_MODE_ACTIVEBACKUP NET_TEAM_MODE_LOADBALANCE \
		MACVLAN MACVTAP IPVLAN IPVTAP VXLAN GENEVE GTP MACSEC NETCONSOLE NTB_NETDEV TAP VETH VIRTIO_NET NLMON NET_VRF MISDN MISDN_DSP MISDN_L1OIP MISDN_HFCPCI MISDN_HFCMULTI MISDN_HFCUSB \
		MISDN_AVMFRITZ MISDN_SPEEDFAX MISDN_INFINEON MISDN_W6692 MISDN_NETJET MISDN_IPAC MISDN_ISAR ISDN_HDLC ISDN_I4L ISDN_CAPI ISDN_CAPI_CAPI20 ISDN_CAPI_CAPIDRV ISDN_DRV_AVMB1_B1PCI \
		ISDN_DRV_AVMB1_AVM_CS ISDN_DRV_AVMB1_T1PCI ISDN_DRV_AVMB1_C4 ISDN_DIVAS ISDN_DIVAS_DIVACAPI ISDN_DIVAS_USERIDI ISDN_DIVAS_MAINT ISDN_DRV_GIGASET \
		ISDN_PPP_BSDCOMP ISDN_DIVERSION ISDN_DRV_HISAX HISAX_SEDLBAUER_CS HISAX_ELSA_CS HISAX_AVM_A1_CS HISAX_TELES_CS HISAX_ST5481 HISAX_HFCUSB HISAX_HFC4S8S \
		HISAX_FRITZ_PCIPNP HISAX NET_9P NET_9P_VIRTIO WIREGUARD NET_SCH_ETS BAREUDP
	nconfig IP_FIB_TRIE_STATS IP_PNP BET_IPGRE_BROADCAST TUN_VNET_CROSS_LE ISDN_CAPI_CAPIDRV_VERBOSE HISAX_DEBUG DECNET RDS_DEBUG
	strconfig DEFAULT_TCP_CONG "cubic"
	strconfig DEFAULT_NET_SCH "fq_codel"

	# Netfilter
	yconfig NETFILTER_INGRESS NETFILTER_FAMILY_BRIDGE NETFILTER_FAMILY_ARP NF_CONNTRACK_MARK NF_CONNTRACK_SECMARK NF_CONNTRACK_ZONES NF_CONNTRACK_PROCFS \
		NF_CONNTRACK_EVENTS NF_CONNTRACK_TIMEOUT NF_CONNTRACK_TIMESTAMP NF_CONNTRACK_LABELS NF_CT_PROTO_DCCP NF_CT_PROTO_GRE NF_CT_PROTO_SCTP NF_CT_PROTO_UDPLITE \
		NETFILTER_NETLINK_GLUE_CT NF_NAT_REDIRECT NF_NAT_MASQUERADE NF_TABLES_INET NF_TABLES_NETDEV IP_VS_IPV6 CONFIG_IP_VS_PROTO_TCP IP_VS_PROTO_UDP IP_VS_PROTO_AH_ESP \
		IP_VS_PROTO_ESP IP_VS_PROTO_AH IP_VS_PROTO_SCTP IP_VS_NFCT NF_TABLES_IPV4 NF_TABLES_ARP NF_TABLES_IPV6 BPF BPFILTER
	mconfig NETFILTER_NETLINK NETFILTER_NETLINK_ACCT NETFILTER_NETLINK_QUEUE NETFILTER_NETLINK_LOG NETFILTER_NETLINK_OSF NF_CONNTRACK NF_LOG_COMMON NF_LOG_NETDEV \
		NETFILTER_CONNCOUNT NF_CONNTRACK_AMANDA NF_CONNTRACK_FTP NF_CONNTRACK_H323 NF_CONNTRACK_IRC NF_CONNTRACK_BROADCAST NF_CONNTRACK_NETBIOS_NS NF_CONNTRACK_SNMP \
		NF_CONNTRACK_PPTP NF_CONNTRACK_SANE NF_CONNTRACK_SIP NF_CONNTRACK_TFTP NF_CT_NETLINK NF_CT_NETLINK_TIMEOUT NF_CT_NETLINK_HELPER NF_NAT NF_NAT_AMANDA NF_NAT_FTP \
		NF_NAT_IRC NF_NAT_SIP NF_NAT_TFTP NETFILTER_SYNPROXY NF_TABLES NF_TABLES_SET NFT_NUMGEN NFT_CT NFT_FLOW_OFFLOAD NFT_COUNTER NFT_CONNLIMIT NFT_LOG NFT_LIMIT NFT_MASQ \
		NFT_REDIR NFT_NAT NFT_TUNNEL NFT_OBJREF NFT_QUEUE NFT_QUOTA NFT_REJECT NFT_REJECT_INET NFT_COMPAT NFT_HASH NFT_FIB NFT_FIB_INET NFT_XFRM NFT_SOCKET NFT_OSF NFT_TPROXY \
		NFT_SYNPROXY NF_DUP_NETDEV NFT_DUP_NETDEV NFT_FWD_NETDEV NFT_FIB_NETDEV NF_FLOW_TABLE_INET NF_FLOW_TABLE NETFILTER_XTABLES NFIG_NETFILTER_XT_MARK NETFILTER_XT_CONNMARK \
		NETFILTER_XT_SET NETFILTER_XT_TARGET_AUDIT NETFILTER_XT_TARGET_CHECKSUM NETFILTER_XT_TARGET_CLASSIFY NETFILTER_XT_TARGET_CONNMARK NETFILTER_XT_TARGET_CONNSECMARK \
		NETFILTER_XT_TARGET_CT NETFILTER_XT_TARGET_DSCP NETFILTER_XT_TARGET_HL NETFILTER_XT_TARGET_HMARK NETFILTER_XT_TARGET_IDLETIMER NETFILTER_XT_TARGET_LED NETFILTER_XT_TARGET_LOG \
		NETFILTER_XT_TARGET_MARK NETFILTER_XT_NAT NETFILTER_XT_TARGET_NETMAP NETFILTER_XT_TARGET_NFLOG NETFILTER_XT_TARGET_NFQUEUE NETFILTER_XT_TARGET_NOTRACK NETFILTER_XT_TARGET_RATEEST \
		NETFILTER_XT_TARGET_REDIRECT NETFILTER_XT_TARGET_MASQUERADE NETFILTER_XT_TARGET_TEE NETFILTER_XT_TARGET_TPROXY NETFILTER_XT_TARGET_TRACE NETFILTER_XT_TARGET_SECMARK \
		NETFILTER_XT_TARGET_TCPMSS NETFILTER_XT_TARGET_TCPOPTSTRIP NETFILTER_XT_MATCH_ADDRTYPE NETFILTER_XT_MATCH_BPF NETFILTER_XT_MATCH_CGROUP NETFILTER_XT_MATCH_CLUSTER \
		NETFILTER_XT_MATCH_COMMENT NETFILTER_XT_MATCH_CONNBYTES NETFILTER_XT_MATCH_CONNLABEL NETFILTER_XT_MATCH_CONNLIMIT NETFILTER_XT_MATCH_CONNMARK NETFILTER_XT_MATCH_CONNTRACK \
		NETFILTER_XT_MATCH_CPU NETFILTER_XT_MATCH_DCCP NETFILTER_XT_MATCH_DEVGROUP NETFILTER_XT_MATCH_DSCP NETFILTER_XT_MATCH_ECN NETFILTER_XT_MATCH_ESP NETFILTER_XT_MATCH_HASHLIMIT \
		NETFILTER_XT_MATCH_HELPER NETFILTER_XT_MATCH_HL NETFILTER_XT_MATCH_IPCOMP NETFILTER_XT_MATCH_IPRANGE NETFILTER_XT_MATCH_IPVS NETFILTER_XT_MATCH_L2TP NETFILTER_XT_MATCH_LENGTH \
		NETFILTER_XT_MATCH_LIMIT NETFILTER_XT_MATCH_MAC NETFILTER_XT_MATCH_MARK NETFILTER_XT_MATCH_MULTIPORT NETFILTER_XT_MATCH_NFACCT NETFILTER_XT_MATCH_OSF NETFILTER_XT_MATCH_OWNER \
		NETFILTER_XT_MATCH_POLICY NETFILTER_XT_MATCH_PHYSDEV NETFILTER_XT_MATCH_PKTTYPE NETFILTER_XT_MATCH_QUOTA NETFILTER_XT_MATCH_RATEEST NETFILTER_XT_MATCH_REALM NETFILTER_XT_MATCH_RECENT \
		NETFILTER_XT_MATCH_SCTP NETFILTER_XT_MATCH_SOCKET NETFILTER_XT_MATCH_STATE NETFILTER_XT_MATCH_STATISTIC NETFILTER_XT_MATCH_STRING NETFILTER_XT_MATCH_TCPMSS NETFILTER_XT_MATCH_TIME \
		NETFILTER_XT_MATCH_U32 IP_SET IP_SET_BITMAP_IP IP_SET_BITMAP_IPMAC IP_SET_BITMAP_PORT IP_SET_HASH_IP IP_SET_HASH_IPMARK IP_SET_HASH_IPPORT IP_SET_HASH_IPPORTIP IP_SET_HASH_IPPORTNET \
		IP_SET_HASH_IPMAC IP_SET_HASH_MAC IP_SET_HASH_NETPORTNET IP_SET_HASH_NET IP_SET_HASH_NETNET IP_SET_HASH_NETPORT IP_SET_HASH_NETIFACE IP_SET_LIST_SET IP_VS IP_VS_RR IP_VS_WRR IP_VS_LC \
		IP_VS_WLC IP_VS_FO IP_VS_OVF IP_VS_LBLC IP_VS_LBLCR IP_VS_DH IP_VS_SH IP_VS_MH IP_VS_SED IP_VS_NQ IP_VS_FTP IP_VS_PE_SIP NF_DEFRAG_IPV4 NF_SOCKET_IPV4 NF_TPROXY_IPV4 NFT_REJECT_IPV4 \
		NFT_DUP_IPV4 NFT_FIB_IPV4 NF_FLOW_TABLE_IPV4 NF_DUP_IPV4 NF_LOG_ARP NF_LOG_IPV4 NF_REJECT_IPV4 NF_NAT_SNMP_BASIC NF_NAT_PPTP NF_NAT_H323 IP_NF_IPTABLES IP_NF_MATCH_AH IP_NF_MATCH_ECN \
		IP_NF_MATCH_RPFILTER IP_NF_MATCH_TTL IP_NF_FILTER IP_NF_TARGET_REJECT IP_NF_TARGET_SYNPROXY IP_NF_NAT IP_NF_TARGET_MASQUERADE IP_NF_TARGET_NETMAP IP_NF_TARGET_REDIRECT IP_NF_MANGLE \
		IP_NF_TARGET_CLUSTERIP IP_NF_TARGET_ECN IP_NF_TARGET_TTL IP_NF_RAW IP_NF_SECURITY IP_NF_ARPTABLES IP_NF_ARPFILTER IP_NF_ARP_MANGLE NF_SOCKET_IPV6 NF_TPROXY_IPV6 NFT_REJECT_IPV6 \
		NFT_DUP_IPV6 NFT_FIB_IPV6 NF_FLOW_TABLE_IPV6 NF_DUP_IPV6 NF_REJECT_IPV6 NF_LOG_IPV6 IP6_NF_IPTABLES IP6_NF_MATCH_AH IP6_NF_MATCH_EUI64 IP6_NF_MATCH_FRAG IP6_NF_MATCH_OPTS \
		IP6_NF_MATCH_HL IP6_NF_MATCH_IPV6HEADER IP6_NF_MATCH_MH IP6_NF_MATCH_RPFILTER IP6_NF_MATCH_RT IP6_NF_MATCH_SRH IP6_NF_TARGET_HL IP6_NF_FILTER IP6_NF_TARGET_REJECT IP6_NF_TARGET_SYNPROXY \
		IP6_NF_MANGLE IP6_NF_RAW IP6_NF_SECURITY IP6_NF_NAT IP6_NF_TARGET_MASQUERADE IP6_NF_TARGET_NPT NF_DEFRAG_IPV6 NF_TABLES_BRIDGE NFT_BRIDGE_META NFT_BRIDGE_REJECT NF_LOG_BRIDGE \
		NF_CONNTRACK_BRIDGE BRIDGE_NF_EBTABLES BRIDGE_EBT_BROUTE BRIDGE_EBT_T_FILTER BRIDGE_EBT_T_NAT BRIDGE_EBT_802_3 BRIDGE_EBT_AMONG BRIDGE_EBT_ARP BRIDGE_EBT_IP BRIDGE_EBT_IP6 \
		BRIDGE_EBT_LIMIT BRIDGE_EBT_MARK BRIDGE_EBT_PKTTYPE BRIDGE_EBT_STP BRIDGE_EBT_VLAN BRIDGE_EBT_ARPREPLY BRIDGE_EBT_DNAT BRIDGE_EBT_MARK_T BRIDGE_EBT_REDIRECT BRIDGE_EBT_SNAT \
		BRIDGE_EBT_LOG BRIDGE_EBT_NFLOG IP_DCCP INET_DCCP_DIAG
	nconfig IP_VS_DEBUG

	# Networking networking drivers
	yconfig NET_VENDOR_AMAZON NET_VENDOR_ARC NET_VENDOR_ATHEROS NET_VENDOR_BROADCOM \
		NET_VENDOR_CAVIUM NET_VENDOR_CISCO NET_VENDOR_GOOGLE NET_VENDOR_HUAWEI \
		NET_VENDOR_IBM NET_VENDOR_INTEL NET_VENDOR_MARVELL NET_VENDOR_MELLANOX \
		NET_VENDOR_NETRONOME NET_VENDOR_NVIDIA NET_VENDOR_QLOGIC NET_VENDOR_QUALCOMM \
		NET_VENDOR_REALTEK NET_VENDOR_TOSHIBA NET_VENDOR_XILINX \
		B44_PCI TIGON3_HWMON BNXT LIQUIDIO_VF MLX4_EN_DCB MLX4_DEBUG MLX4_CORE_GEN2 \
		MLX5_ACCEL MLX5_FPGA MLX5_CORE_EN MLX5_EN_ARFS MLX5_EN_RXNFC MLX5_MPFS \
		MLX5_ESWITCH MLX5_TC_CT MLX5_CORE_EN_DCB MLX5_CORE_IPOIB MLX5_FPGA_IPSEC \
		MLX5_EN_IPSEC MLX5_FPGA_TLS MLX5_TLS MLX5_EN_TLS MLX5_SW_STEERING \
		MLXSW_CORE_HWMON MLXSW_CORE_THERMAL MLXSW_SPECTRUM_DCB NFP_APP_FLOWER \
		NFP_APP_ABM_NIC  QLCNIC_SRIOV QLCNIC_DCB QLCNIC_HWMON QED_LL2 QED_SRIOV \
		QED_RDMA QED_ISCSI QED_FCOE QED_OOO
	mconfig ENA_ETHERNET ARC_EMAC AG71XX ATL2 ATL1 ATL1E ATL1C ALX B44 BCM63XX_ENET \
		BCMGENET BNX2 CNICN SB1250_MAC TIGON3 BGMAC THUNDER_NIC_PF THUNDER_NIC_VF \
		THUNDER_NIC_BGX THUNDER_NIC_RGX LIQUIDIO ENIC GVE HINIC MVMDIO MV643XX_ETH \
		MVNETA MVPP2 PXA168_ETH SKGE SKY2 MLX4_EN MLX5_CORE MLX4_CORE MLXSW_CORE \
		MLXSW_PCI MLXSW_I2C MLXSW_SWITCHIB MLXSW_SWITCHX2 MLXSW_SPECTRUM MLXSW_MINIMAL MLXFW \
		NFP FORCEDETH QLA3XXX QLCNIC NETXEN_NIC QED QEDE QCA7000 QCA7000_SPI QCA7000_UART \
		QCOM_EMAC RMNET XILINX_EMACLITE XILINX_AXI_EMAC XILINX_LL_TEMAC
	nconfig NFP_DEBUG

	# Platform specific networking drivers
	case $BARCH in
		x86_64)
			yconfig IAVF 8139TOO_TUNE_TWISTER 8139TOO_8129
			mconfig E100 E1000 E1000E IGB IGBVF IXGB IXGBE IXGBEVF I40E I40EVF ICE FM10K IGC \
				ATP 8139CP 8139TOO R8169
			nconfig 8139_OLD_RX_RESET 8139TOO_PIO
			;;
		aarch64|armv7hnl)
			mconfig EMAC_ROCKCHIP
			;;
		ppc64le|ppc64)
			yconfig IBM_EMAC
			mconfig IBMVETH EHEA IBMVNIC GELIC_NET GELIC_WIRELESS SPIDER_NET
			;;
		ppc)
			yconfig NET_VENDOR_APPLE
			mconfig MACE BMAC MACMACE
			;;
	esac

	# Wireless networking drivers
	yconfig B43_BCMA_PIO B43_BCMA B43_BUSES_BCMA_AND_SSB B43_HWRNG B43_LEDS B43_PHY_G B43_PHY_HT B43_PHY_LP B43_PHY_N B43_PIO B43_SDIO B43_SSB BRCMFMAC_PCIE BRCMFMAC_PROTO_BCDC \
		BRCMFMAC_PROTO_MSGBUF BRCMFMAC_SDIO HOSTAP_FIRMWARE_NVRAM HOSTAP_FIRMWARE IPW2100_MONITOR IPW2200_MONITOR IPW2200_PROMISCUOUS IPW2200_QOS IPW2200_RADIOTAP IWLWIFI_LEDS \
		IWLWIFI_OPMODE_MODULAR IWLWIFI_PCIE_RTPM P54_LEDS RT2800PCI_RT3290 RT2800PCI_RT33XX RT2800PCI_RT35XX RT2800PCI_RT53XX RT2X00_LIB_CRYPTO RT2X00_LIB_FIRMWARE RT2X00_LIB_LEDS \
		WIL6210_ISR_COR WLAN_VENDOR_ADMTEK WLAN_VENDOR_ATH WLAN_VENDOR_ATMEL WLAN_VENDOR_BROADCOM WLAN_VENDOR_INTEL WLAN_VENDOR_INTERSIL WLAN_VENDOR_MARVELL WLAN_VENDOR_RALINK WLAN_VENDOR_REALTEK
	mconfig ADM8211 ATH_COMMON ATH5K ATH9K_HW ATH9K_COMMON ATH9K ATH9K_HTC CARL9170 ATH6KL ATH6KL_SDIO ATH6KL_USB AR5523 WIL6210 ATH10K \
		ATH10K_PCI ATH10K_SDIO ATH10K_USB WCN36XX ATMEL PCI_ATMEL AT76C50X_USB B43 B43LEGACY BRCMUTIL BRCMSMAC BRCMFMAC AIRO AIRO_CS IPW2100 IPW2200 LIBIPW \
		IWLEGACY IWL4965 IWL3945 IWLWIFI IWLDVM IWLMVM HERMES PLX_HERMES TMD_HERMES NORTEL_HERMES ORINOCO_USB P54_COMMON P54_USB P54_PCI \
		PRISM54 LIBERTAS LIBERTAS_USB LIBERTAS_CS LIBERTAS_SDIO LIBERTAS_THINFIRM LIBERTAS_THINFIRM_USB MWIFIEX MWIFIEX_SDIO MWIFIEX_PCIE \
		MWIFIEX_USB MWL8K MT7601U MT76_CORE MT76_USB MT76x2_COMMON MT76x0U MT76x2E MT76x2U RT2X00 RT2400PCI RT2500PCI RT61PCI RT2800PCI \
		RT2500USB RT73USB RT2800USB RT2800_LIB RT2800_LIB_MMIO RT2X00_LIB_MMIO RT2X00_LIB_PCI RT2X00_LIB_USB RT2X00_LIB RTL8180 RTL8187 \
		RTL_CARDS RTL8192CE RTL8192SE RTL8192DE RTL8723AE RTL8723BE RTL8188EE RTL8192EE RTL8821AE RTL8192CU RTLWIFI RTLWIFI_PCI \
		RTLWIFI_USB RTL8192C_COMMON RTL8723_COMMON RTLBTCOEXIST RTL8XXXU RSI_91X RSI_SDIO RSI_USB CW1200 CW1200_WLAN_SDIO WL1251 \
		WL1251_SDIO WL12XX WL18XX WLCORE WLCORE_SDIO USB_ZD1201 ZD1211RW QTNFMAC QTNFMAC_PEARL_PCIE USB_NET_RNDIS_WLAN \
		MT76x0U MT76x0E MT76x2E MT76x2U MT7603E IONIC ATH11K RTW88_8822BE R8188EU RTL8192E R8712U RTL8723BS
	nconfig RTLWIFI_DEBUG

	# Virtualization support
	yconfig VIRTIO_PCI VIRTIO_BALLOON VIRTIO_MMIO VIRTIO_CONSOLE IOMMU_SUPPORT IRQ_REMAP \
		VFIO VFIO_PCI VFIO_PCI_VGA HYPERVISOR_GUEST PARAVIRT PARAVIRT_SPINLOCKS PARAVIRT_GUEST \
		CONNECTOR SCSI_FC_ATTRS XEN HVC_DRIVER HVC_XEN XEN_FBDEV_FRONTEND XEN_BLKDEV_FRONTEND \
		XEN_NETDEV_FRONTEND XEN_PCIDEV_FRONTEND INPUT_XEN_KBDDEV_FRONTEND XEN_FBDEV_FRONTEND \
		XEN_XENBUS_FRONTEND XEN_SAVE_RESTORE XEN_DOM0 XEN_DEV_EVTCHN XENFS XEN_COMPAT_XENFS \
		XEN_SYS_HYPERVISOR XEN_GNTDEV XEN_BACKEND XEN_NETDEV_BACKEND XEN_BALLOON XEN_SCRUB_PAGES \
		VDPA
	mconfig VHOST_NET VHOST_SCSI VHOST_VSOCK VHOST KVM XEN_GRANT_DEV_ALLOC XEN_BLKDEV_BACKEND

	# Platform specific virtualiztion
	case $BARCH in
		x86_64)
			yconfig INTEL_IOMMU INTEL_IOMMU_SVM AMD_IOMMU AMD_IOMMU_V2 XEN_TMEM CLEANCACHE \
				FRONTSWAP XEN_SELFBALLOONING X86_IO_APIC ACPI_PROCFS PCI_XEN
			mconfig XEN_PCIDEV_BACKEND
			;;
	esac

	# GPU support
	yconfig DRM_MIPI_DSI DRM_DP_AUX_CHARDEV DRM_KMS_FB_HELPER DRM_GEM_CMA_HELPER DRM_KMS_CMA_HELPER DRM_GEM_SHMEM_HELPER DRM_VM \
		DRM_RADEON_USERPTR DRM_AMDGPU_SI DRM_AMDGPU_CIK DRM_AMDGPU_USERPTR DRM_AMD_DC DRM_AMD_DC_DCN1_0 DRM_AMD_DC_DCN2_0 \
		DRM_AMD_DC_DCN2_1 DRM_AMD_DC_DSC_SUPPORT HSA_AMD DRM_NOUVEAU_BACKLIGHT DRM_NOUVEAU_SVM DRM_PANEL DMABUF_MOVE_NOTIFY
	mconfig DRM DRM_SCHED DRM_MIPI_DBI DRM_KMS_HELPER DRM_TTM DRM_RADEON DRM_AMDGPU DRM_NOUVEAU DRM_VKMS DRM_QXL \
		DRM_VIRTIO_GPU DRM_CIRRUS_QEMU
	nconfig DEBUG_KERNEL_DC DRM_LEGACY NOUVEAU_LEGACY_CTX_SUPPORT
	strconfig DRM_I915_FORCE_PROBE "*"

	# Platform specific GPU support
	case $BARCH in
		x86_64)
			yconfig DRM_I915_CAPTURE_ERROR DRM_I915_COMPRESS_ERROR \
				DRM_I915_USERPTR DRM_GMA600 DRM_GMA3600 DRM_VMWGFX_FBCON
			mconfig DRM_I915 DRM_VMWGFX DRM_GMA500
			;;
	esac

	# Display panel support
	yconfig DRM_BRIDGE DRM_PANEL_BRIDGE DRM_DISPLAY_CONNECTOR
	mconfig DRM_PANEL_ARM_VERSATILE DRM_PANEL_LVDS DRM_PANEL_SIMPLE DRM_PANEL_ILITEK_IL9322 DRM_PANEL_INNOLUX_P079ZCA \
		DRM_PANEL_JDI_LT070ME05000 DRM_PANEL_SAMSUNG_LD9040 DRM_PANEL_LG_LG4573 DRM_PANEL_ORISETECH_OTM8009A \
		DRM_PANEL_PANASONIC_VVX10F034N00 DRM_PANEL_RASPBERRYPI_TOUCHSCREEN DRM_PANEL_RAYDIUM_RM68200 \
		DRM_PANEL_SAMSUNG_S6E3HA2 DRM_PANEL_SAMSUNG_S6E63J0X03 DRM_PANEL_SAMSUNG_S6E8AA0 DRM_PANEL_SEIKO_43WVF1G \
		DRM_PANEL_SHARP_LQ101R1SX01 DRM_PANEL_SHARP_LS043T1LE01 DRM_PANEL_SITRONIX_ST7789V \
		DRM_PANEL_SONY_ACX565AKM DRM_PANEL_TPO_TD028TTEC1 DRM_PANEL_TPO_TD043MTEA1 DRM_PANEL_SHARP_LS037V7DW01 \
		DRM_PANEL_RAYDIUM_RM67191 DRM_PANEL_LG_LB035Q02 DRM_PANEL_NEC_NL8048HL11 DRM_PARADE_PS8640 DRM_TI_TPD12S015 \
		DRM_PANEL_BOE_TV101WUM_NL6

	# Web camera support
	yconfig USB_VIDEO_CLASS_INPUT_EVDEV USB_PWC_INPUT_EVDEV
	mconfig USB_VIDEO_CLASS USB_GSPCA USB_M5602 USB_STV06XX USB_GL860 \
		USB_GSPCA_BENQ USB_GSPCA_CONEX USB_GSPCA_CPIA1 USB_GSPCA_DTCS033 USB_GSPCA_ETOMS USB_GSPCA_FINEPIX \
		USB_GSPCA_JEILINJ USB_GSPCA_JL2005BCD USB_GSPCA_KINECT USB_GSPCA_KONICA USB_GSPCA_MARS USB_GSPCA_MR97310A \
		USB_GSPCA_NW80X USB_GSPCA_OV519 USB_GSPCA_OV534 USB_GSPCA_OV534_9 USB_GSPCA_PAC207 USB_GSPCA_PAC7302 \
		USB_GSPCA_PAC7311 USB_GSPCA_SE401 USB_GSPCA_SN9C2028 USB_GSPCA_SN9C20X USB_GSPCA_SONIXB USB_GSPCA_SONIXJ \
		USB_GSPCA_SPCA500 USB_GSPCA_SPCA501 USB_GSPCA_SPCA505 USB_GSPCA_SPCA506 USB_GSPCA_SPCA508 USB_GSPCA_SPCA561 \
		USB_GSPCA_SPCA1528 USB_GSPCA_SQ905 USB_GSPCA_SQ905C USB_GSPCA_SQ930X USB_GSPCA_STK014 USB_GSPCA_STK1135 \
		USB_GSPCA_STV0680 USB_GSPCA_SUNPLUS USB_GSPCA_T613 USB_GSPCA_TOPRO USB_GSPCA_TOUPTEK USB_GSPCA_TV8532 \
		USB_GSPCA_VC032X USB_GSPCA_VICAM USB_GSPCA_XIRLINK_CIT USB_GSPCA_ZC3XX USB_PWC \
		VIDEO_CPIA2 USB_ZR364XX USB_STKWEBCAM USB_S2255 VIDEO_USBTV

	# Charges support
	yconfig W1_CON POWER_AVS POWER_RESET PDA_POWER CHARGER_MANAGER
	mconfig W1 CHARGER_ADP5061 BATTERY_DS2780 BATTERY_DS2781 BATTERY_DS2782 \
		BATTERY_SBS CHARGER_SBS BATTERY_BQ27XXX BATTERY_MAX17040 BATTERY_MAX17042 \
		CHARGER_MAX8903 CHARGER_LP8727 CHARGER_GPIO CHARGER_LTC365 \
		CHARGER_BQ2415X CHARGER_BQ24257 CHARGER_BQ24735 CHARGER_BQ25890 CHARGER_SMB347 BATTERY_GAUGE_LTC2941 CHARGER_RT9455

	# Sensors support
	mconfig SENSORS_ATK0110 SENSORS_ABITUGURU SENSORS_ABITUGURU3 SENSORS_AD7414 SENSORS_AD7418 \
		SENSORS_ADM1021 SENSORS_ADM1025 SENSORS_ADM1026 SENSORS_ADM1029 SENSORS_ADM1031 \
		SENSORS_ADM9240 SENSORS_ADS7828 SENSORS_ADT7462 SENSORS_ADT7470 SENSORS_ADT7473 \
		SENSORS_ADT7475 SENSORS_APPLESMC SENSORS_ASB100 SENSORS_ATXP1 SENSORS_CORETEMP \
		SENSORS_DME1737 SENSORS_DS1621 SENSORS_DS1337 SENSORS_DS1374 SENSORS_FSCHER \
		SENSORS_FSCPOS SENSORS_F71805F SENSORS_F71882FG SENSORS_F75375S SENSORS_FSCHMD \
		SENSORS_G760A SENSORS_GL518SM SENSORS_GL520SM SENSORS_HDAPS SENSORS_IBMAEM SENSORS_IBMPEX \
		SENSORS_IT87 SENSORS_K8TEMP SENSORS_LIS3LV02D SENSORS_LM63 SENSORS_LM75 SENSORS_LM77 \
		SENSORS_LM78 SENSORS_LM80 SENSORS_LM83 SENSORS_LM85 SENSORS_LM87 SENSORS_LM90 \
		SENSORS_LM92 SENSORS_LM93 SENSORS_LTC4245 SENSORS_MAX1619 SENSORS_MAX6650 \
		SENSORS_MAX6875 SENSORS_PC87360 SENSORS_PC87427 SENSORS_PCA9539 SENSORS_PCF8574 \
		SENSORS_PCF8591 SENSORS_SHT15 SENSORS_SIS5595 SENSORS_SMSC47M1 SENSORS_SMSC47M192 \
		SENSORS_SMSC47B397 SENSORS_THMC50 SENSORS_TMP401 SENSORS_TSL2550 \
		SENSORS_VIA686A SENSORS_VIA_CPUTEMP SENSORS_VT1211 SENSORS_VT8231 SENSORS_W83627HF \
		SENSORS_W83781D SENSORS_W83L785TS SENSORS_W83L786NG SENSORS_W83627EHF SENSORS_W83791D \
		SENSORS_W83792D SENSORS_W83793 SENSORS_LTC4215 SENSORS_LM95241 SENSORS_TMP421 SENSORS_WM8350 SENSORS_WM831X
	nconfig SENSORS_I5K_AMBDS1682

	# Security
	yconfig SECURITY SECURITYFS SECURITY_NETWORK SECURITY_PATH SECURITY_YAMA SECURITY_SELINUX \
		DEFAULT_SECURITY_SELINUX SECURITY_SELINUX_DEVELOP \
		STATIC_USERMODEHELPER_PATH STRICT_KERNEL_RWX STRICT_MODULE_RWX \
		STACKPROTECTOR STACKPROTECTOR_STRONG SYN_COOKIES SLAB_FREELIST_RANDOM SLAB_FREELIST_HARDENED \
		SHUFFLE_PAGE_ALLOCATOR HARDENED_USERCOPY PAGE_POISONING PAGE_POISONING_NO_SANITY PAGE_POISONING_ZERO \
		VMAP_STACK SECURITY_DMESG_RESTRICT
	nconfig DEVMEM DEVKMEM HARDENED_USERCOPY_FALLBACK HARDENED_USERCOPY_PAGESPAN LEGACY_PTYS \
		ACPI_CUSTOM_METHOD COMPAT_BRK ROC_KCORE COMPAT_VDS SECURITY_SELINUX_BOOTPARAM \
		SECURITY_SELINUX_DISABLE SECURITY_SELINUX_CHECKREQPROT_VALUE
	varconfig ARCH_MMAP_RND_BITS 32

	# Platform specific security
	case $BARCH in
		x86_64)
			yconfig RANDOMIZE_BASE RANDOMIZE_MEMORY PAGE_TABLE_ISOLATION LEGACY_VSYSCALL_NONE
			nconfig X86_X32 MODIFY_LDT_SYSCALL
			varconfig DEFAULT_MMAP_MIN_ADDR 65536
			;;
		aarch64)
			yconfig ARM64_SW_TTBR0_PAN UNMAP_KERNEL_AT_EL0
			varconfig DEFAULT_MMAP_MIN_ADDR 32768
			;;
		armv7hnl|armv6hl)
			yconfig VMSPLIT_3G STRICT_MEMORY_RWX CPU_SW_DOMAIN_PAN
			nconfig OABI_COMPAT
			varconfig DEFAULT_MMAP_MIN_ADDR 32768
			;;
	esac

	# GCC plugins
	yconfig GCC_PLUGINS GCC_PLUGIN_LATENT_ENTROPY GCC_PLUGIN_STRUCTLEAK GCC_PLUGIN_STRUCTLEAK_BYREF_ALL \
		GCC_PLUGIN_RANDSTRUCT GCC_PLUGIN_STACKLEAK STACKLEAK_METRICS STACKLEAK_RUNTIME_DISABLE
	nconfig GCC_PLUGIN_RANDSTRUCT_PERFOMANCE STACKLEAK_METRICS STACKLEAK_RUNTIME_DISABLE
	varconfig STACKLEAK_TRACK_MIN_SIZE 100

	sed -i "s/^CONFIG_DEBUG_KERNEL.*/\\# CONFIG_DEBUG_KERNEL is not set/" .config

	if [ "$USEBOOTSTRAP" = "yes" ]; then
		yes '' | make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE} oldconfig
	else
		yes '' | make ARCH=$XKARCH oldconfig
	fi
}


build() {
	case $BARCH in
		x86_64)
			export XKARCH="x86_64"
			export IMAGELOC="arch/x86/boot/bzImage"
			;;
		aarch64)
			export XKARCH="arm64"
			export IMAGELOC="arch/arm64/boot/Image"
			;;
		armv7hnl|armv6hl)
			export XKARCH="arm"
			export IMAGELOC="arch/arm/boot/zImage"
			;;
		ppc64le|ppc64|ppc)
			export XKARCH="powerpc"
			export IMAGELOC="vmlinux"
			;;
		s390x)
			export XKARCH="s390"
			export IMAGELOC="arch/s390/boot/bzImage"
			;;
		riscv64|riscv32)
			export XKARCH="riscv"
			export IMAGELOC="arch/riscv/boot/Image"
			;;
		*)
			echo "Architecture is not set or is not supported by Ataraxia Linux"
			exit 1
	esac

	case $BARCH in
		riscv64|riscv32)
			patch -Np1 -i "$STUFF"/linux/9999-RISC-V-fixes.patch
			;;
	esac

	unset LDFLAGS
	make mrproper

	generate_config

	if [ "$USEBOOTSTRAP" = "yes" ]; then
		yes '' | make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE}
	else
		yes '' | make ARCH=$XKARCH
	fi

	if [ "$USEBOOTSTRAP" = "yes" ]; then
		make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE} INSTALL_MOD_STRIP=1 INSTALL_MOD_PATH="$PKG"/usr modules_install
	else
		make ARCH=$XKARCH INSTALL_MOD_STRIP=1 INSTALL_MOD_PATH="$PKG"/usr modules_install
	fi

	depmod -a -b "$PKG"/usr ${kver}-lfs

	case $BARCH in
		aarch64|armv7hnl|armv6hl)
			if [ "$USEBOOTSTRAP" = "yes" ]; then
				make ARCH=$XKARCH CROSS_COMPILE=${CROSS_COMPILE} INSTALL_DTBS_PATH="$PKG"/boot/dtbs dtbs_install
			else
				make ARCH=$XKARCH INSTALL_DTBS_PATH="$PKG"/boot/dtbs dtbs_install
			fi
			;;
	esac

	mkdir -p "$PKG"/boot
	cp "$IMAGELOC" "$PKG"/boot/vmlinuz-lfs
	cp .config "$PKG"/boot/config-lfs

	rm -rf "$PKG"/usr/lib/modules/${kver}-lfs/build
	rm -rf "$PKG"/usr/lib/modules/${kver}-lfs/source
}
